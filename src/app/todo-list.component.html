

<div class="wrapper">
  <div class="header">
    <h1>üìù to-do list:</h1>
  </div>
  
  <div class="search-task">
    <input
      tuiTextfield
      [formControl]="searchControl"
      placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á"
      size="m"
      appearance="outline"
      style="width:100%;"
    />
  </div>

  <div class="add-task">
    <input
      tuiTextfield
      [(ngModel)]="newTitle"
      placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"
      [maxlength]="maxTitleLength"
      size="m"
      style="flex:1;"
      (keydown.enter)="add()"
    />

    <button
      tuiButton
      appearance="primary"
      size="m"
      (click)="add()"
      [disabled]="!newTitle.trim()"
    >
      –î–æ–±–∞–≤–∏—Ç—å
    </button>
  </div>
</div>

<div class="container">
    <ng-container *ngIf="tasks$ | async as tasks">
      <div *ngFor="let task of tasks$ | async" 
          class="task-card"
          [class.completed]="task.checked"
      >
        <div tuiBlock="m">
          <div class="task-inner">
            <input
                size="s"
                tuiCheckbox
                type="checkbox"
                [checked]="task.checked"
                [formControl]="controls[task.id]"
            />

            <!-- —Ä–µ–∂–∏–º –ü–†–û–°–ú–û–¢–†–ê -->
            <ng-container *ngIf="editingId != task.id">
              <div class="task-left-side">
                <!-- [innerHTML]="highlightMatch(task.title, searchControl.value || '')" -->
                <span (dblclick)="startEditing(task)" style="cursor:text;"
                      >
                  {{ task.title }}
                </span>
              </div>
              <div class="task-right-side">
                <button 
                  (click)="startEditing(task)"
                  title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É"
                  appearance="icon"
                >‚úèÔ∏è</button>

                <button
                    type="button"
                    (click)="delete(task.id)"
                    title="–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É"
                    appearance="icon"
                >üóëÔ∏è</button>
              </div>
            </ng-container>

            <!-- —Ä–µ–∂–∏–º –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
            <ng-container *ngIf="editingId == task.id">
              <div class="task-left-side">
                <input
                  tuiTextfield
                  [(ngModel)]="editingTitle"
                  maxlength="100"
                  (keydown.enter)="saveChanges()"
                  style="flex:1;"
                />

                <button 
                    (click)="saveChanges()"
                    title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
                    appearance="icon"
                >
                  ‚úîÔ∏è
                </button>

                <button 
                    (click)="cancelEditing()"
                    title="–û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
                    appearance="icon"
                >
                  ‚úñÔ∏è
                </button>
              </div>

              <div class="task-right">
                <button
                    type="button"
                    (click)="delete(task.id)"
                    title="–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É"
                    appearance="icon"
                >üóëÔ∏è</button>
              </div>
            </ng-container>
            
          </div>
        </div>
      </div>

      <li *ngIf="tasks.length === 0">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</li>
    </ng-container>

  </div>
