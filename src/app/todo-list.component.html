<h1>to-do list:</h1>
<div>
  <div class="container">
    <ng-container *ngIf="tasks$ | async as tasks">
      <div *ngFor="let task of tasks$ | async" 
          class="task-card"
          [class.completed]="task.checked"
      >
        <label tuiBlock="m">
          <div class="task-inner">
            <input
                size="s"
                tuiCheckbox
                type="checkbox"
                [checked]="task.checked"
                [formControl]="controls[task.id]"
            />

            <!-- режим ПРОСМОТРА -->
            <ng-container *ngIf="editingId != task.id">
              {{ task.title }}

              <button 
                  (click)="startEditing(task)"
                  title="Редактировать задачу"
              >
                ✏️
              </button>

              <button
                  type="button"
                  (click)="delete(task.id)"
                  title="Удалить задачу"
              >
                ❌
              </button>
            </ng-container>

            <!-- режим РЕДАКТИРОВАНИЯ -->
            <ng-container *ngIf="editingId == task.id">
              <input type="text" [(ngModel)]="editingTitle" />

              <button 
                  (click)="saveChanges()"
                  title="Сохранить изменения"
              >
                ✔️
              </button>

              <button 
                  (click)="cancelEditing()"
                  title="Отменить изменения"
              >
                ✖️
              </button>


              <button
                  type="button"
                  (click)="delete(task.id)"
                  title="Удалить задачу"
              >
                ❌
              </button>
            </ng-container>
            
          </div>
        </label>
      </div>

      <li *ngIf="tasks.length === 0">Ничего не найдено</li>
    </ng-container>

  </div>

</div>
